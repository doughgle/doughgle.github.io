<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.111.3"><link rel=icon href=/images/icon.jpg><title>How To Pull And Verify Any Public Helm Chart From An OCI Registry | Douglas Hellinger</title><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.douglashellinger.com/how-to/proxy-public-chart-repositories-as-oci-artefacts/1-public-chart-oci-image-reference-cover.drawio.svg"><meta name=twitter:title content="How To Pull And Verify Any Public Helm Chart From An OCI Registry"><meta name=twitter:description content="When you wanna pull a public helm chart from an OCI registry&mldr;
Some public charts aren&rsquo;t yet published as OCI artifacts. For those charts, one elegant solution is to use the open source Helm Chart OCI Proxy."><meta property="og:title" content="How To Pull And Verify Any Public Helm Chart From An OCI Registry"><meta property="og:description" content="When you wanna pull a public helm chart from an OCI registry&mldr;
Some public charts aren&rsquo;t yet published as OCI artifacts. For those charts, one elegant solution is to use the open source Helm Chart OCI Proxy."><meta property="og:type" content="article"><meta property="og:url" content="https://www.douglashellinger.com/how-to/proxy-public-chart-repositories-as-oci-artefacts/"><meta property="og:image" content="https://www.douglashellinger.com/how-to/proxy-public-chart-repositories-as-oci-artefacts/1-public-chart-oci-image-reference-cover.drawio.svg"><meta property="article:section" content="how-to"><meta property="article:published_time" content="2023-10-12T22:30:44+08:00"><meta property="article:modified_time" content="2023-09-17T16:29:44+08:00"><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css rel=stylesheet integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet><link rel=stylesheet href=https://www.douglashellinger.com/css/medium.a3d5489836b19de22a81ddc6bd21c17547d07529e67b266427378a04fa3ea727.css integrity="sha256-o9VImDaxneIqgd3GvSHBdUfQdSnmeyZkJzeKBPo+pyc="><link rel=stylesheet href=https://www.douglashellinger.com/css/additional.8819b6defcdc6d21280f9b402b00df87ca779135901de6c22e708c62e20184b9.css integrity="sha256-iBm23vzcbSEoD5tAKwDfh8p3kTWQHebCLnCMYuIBhLk="></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=https://www.douglashellinger.com/><img src=/images/icon.jpg alt=logo></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/blog>Blog</a></li><li class=nav-item><a class=nav-link href=/explainer>Explainers</a></li><li class=nav-item><a class=nav-link href=/food>Food</a></li><li class=nav-item><a class=nav-link href=/how-to>How to Guides</a></li><li class=nav-item><a class=nav-link href=/>About</a></li></ul></div></div></nav><div class=site-content><div class=container><div class=mainheading><h1 class=sitetitle>Douglas Hellinger</h1><p class=lead>Helping you have fun and maximise impact by learning containers and kubernetes!</p></div><div class=main-content><div class=container><div class=row><div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset"><p>Share</p><ul><li class="ml-1 mr-1"><a target=_blank href="https://twitter.com/intent/tweet?text=How%20To%20Pull%20And%20Verify%20Any%20Public%20Helm%20Chart%20From%20An%20OCI%20Registry&url=https%3a%2f%2fwww.douglashellinger.com%2fhow-to%2fproxy-public-chart-repositories-as-oci-artefacts%2f" onclick='return window.open(this.href,"twitter-share","width=550,height=435"),!1'><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://facebook.com/sharer.php?u=https%3a%2f%2fwww.douglashellinger.com%2fhow-to%2fproxy-public-chart-repositories-as-oci-artefacts%2f" onclick='return window.open(this.href,"facebook-share","width=550,height=435"),!1'><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://www.xing.com/spi/shares/new?url=https%3a%2f%2fwww.douglashellinger.com%2fhow-to%2fproxy-public-chart-repositories-as-oci-artefacts%2f" onclick='return window.open(this.href,"xing-share","width=550,height=435"),!1'><i class="fab fa-xing"></i></a></li></ul><div class=sep></div><ul><li><a class="small smoothscroll" href=#disqus_thread></a></li></ul></div></div><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><div class="row post-top-meta"><div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right"><img class=author-thumb src=/images/profile.jpg alt="Douglas Hellinger"></div><div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left"><a target=_blank class=link-dark>Douglas Hellinger</a><br><span class=author-description>Creator of this blog.<br><i class="far fa-star"></i>
Oct 12, 2023
<i class="far fa-clock clock"></i>
6 min read</span></div></div><h1 class=posttitle>How To Pull And Verify Any Public Helm Chart From An OCI Registry</h1></div><img class="featured-image img-fluid" src=https://www.douglashellinger.com/how-to/proxy-public-chart-repositories-as-oci-artefacts/1-public-chart-oci-image-reference-cover.drawio.svg alt="thumbnail for this post"><div class=article-post><p><strong>When you wanna pull a public helm chart from an OCI registry&mldr;</strong></p><p>Some public charts aren&rsquo;t yet published as OCI artifacts. For those charts, one elegant solution is to use the open source <a href=https://github.com/container-registry/helm-charts-oci-proxy>Helm Chart OCI Proxy</a>.</p><p>It enables you to pull any public helm chart as an OCI Image.</p><p>You don&rsquo;t need to add a helm repo at the helm client. If you&rsquo;re using a central binary repository to aggregate helm repos, you don&rsquo;t need to add a helm repo there either!</p><p>The Helm Chart Proxy OCI Registry is publicly hosted at <code>chartproxy.container-registry.com</code> and free to use *.</p><p>This How To Guide shows you the steps..!</p><blockquote><p>* Helm Chart OCI Proxy is licensed under GNU Affero General Public License v3.0 - always read the license.</p></blockquote><h3 id=youll-need>You&rsquo;ll Need</h3><ul><li>Helm >= v3.8</li><li>Cosign v2+</li></ul><h2 id=1-check-if-the-chart-is-already-published-as-an-oci-artifact>1. Check If The Chart Is Already Published As An OCI Artifact</h2><p>For example, the <a href="https://github.com/orgs/prometheus-community/packages?repo_name=helm-charts">Prometheus Community Helm Charts</a> are already published to GitHub Container Registry (GHCR).</p><p><img src=./github-packages-chart-as-oci-image.drawio.svg alt="Github Packages Showing Prometheus Chart Packaged As Oci Artifact" title="OCI Registry as Storage"></p><p>If the chart is available as an OCI artifact, you can pull the chart directly from the OCI registry:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm pull <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  oci://ghcr.io/prometheus-community/charts/prometheus <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --version 25.1.0
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Pulled: ghcr.io/prometheus-community/charts/prometheus:25.1.0
</span></span><span style=display:flex><span>Digest: sha256:6802170c564274eff6408f1bdc91705a395a027dae1e981504c776845ca1965f
</span></span></code></pre></div><p>That&rsquo;s it!</p><p>Alternative public OCI Registries to check for charts:</p><ol><li><a href="https://gallery.ecr.aws/search?searchTerm=chart&amp;verified=verified&amp;page=1">AWS ECR Public Gallery</a>: Some AWS/Partner Helm Charts are available. For example the <a href=https://gallery.ecr.aws/karpenter/karpenter>Karpenter Helm Chart</a>.</li><li><a href=https://hub.docker.com/>Dockerhub</a>: For example, all <a href=https://hub.docker.com/u/bitnamicharts>Bitnami Helm Charts</a> are available.</li></ol><p>If the chart isn&rsquo;t already published as an OCI artifact, read on&mldr;</p><h2 id=2-construct-the-oci-chart-reference>2. Construct The OCI Chart Reference</h2><h3 id=21-copy-the-helm-repository-url>2.1 Copy The Helm Repository URL</h3><p>Example Chart: <strong>tigera-operator</strong></p><p>From <a href="https://artifacthub.io/packages/helm/projectcalico/tigera-operator?modal=install">artifacthub.io -> Install page</a>, copy <strong>docs.projectcalico.org/charts/</strong> (omit the <strong><code>https://</code></strong>)</p><p><img src=./artifacthub-install-helm-chart-from-helm-repo.drawio.svg alt="Install Dialog On artifacthub.io Showing Steps To Use Classic Helm Repo" title="OCI Chart Refs: two (steps) become one"></p><h3 id=22-append-the-helm-repo-url-to-the-chart-proxy-registry-url>2.2 Append The Helm Repo URL To The Chart Proxy Registry URL</h3><p><code>oci://chartproxy.container-registry.com/</code><strong>docs.projectcalico.org/charts/</strong></p><h3 id=23-append-the-chart-name>2.3 Append The Chart Name</h3><p><code>oci://chartproxy.container-registry.com/docs.projectcalico.org/charts/</code><strong>tigera-operator</strong></p><p>Now you can use the OCI chart ref Helm v3.8 or greater.</p><p><img src=./1-public-chart-oci-image-reference-cover.drawio.svg alt="Diagram Showing Anatomy Of An Oci Chart Reference" title="OCI Chart Ref: That's it!"></p><h2 id=3-pull-from-oci-registry-using-the-oci-chart-reference>3. Pull From OCI Registry Using The OCI Chart Reference</h2><p>Now pull the <code>tigera-operator</code> chart from <code>chartproxy.container-registry.com</code> using the oci chart reference.</p><p>Use <code>--version</code> to specify the chart version in the helm client (not OCI image tag).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm pull <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  oci://chartproxy.container-registry.com/docs.projectcalico.org/charts/tigera-operator <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --version 3.26.1
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Pulled: chartproxy.container-registry.com/docs.projectcalico.org/charts/tigera-operator:3.26.1
</span></span><span style=display:flex><span>Digest: sha256:1e72052d066b8bcf3adbc5de201e05728b3be75c55b83506f78fc6691a2ce9c2
</span></span></code></pre></div><h2 id=4-verify-the-charts-signature>4. Verify The Chart&rsquo;s Signature</h2><p>Verify the chart comes from a <strong>trusted publisher</strong> and is <strong>unmodified</strong> <em>before</em> you install it!</p><p>Depending on the chart&rsquo;s signing method, verify using 1 of these 3 methods:</p><ol><li>Verify Using Cosign</li><li>Verify The Provenance Layer In OCI Image</li><li>Verify Using The Provenance File Stored In Classic Helm Repo</li></ol><h3 id=41-verify-using-cosign>4.1. Verify Using Cosign</h3><p>Some charts may use the <a href=https://www.sigstore.dev/>Sigstore</a> ecosystem to sign and verify.</p><p>For example, to verify the latest cloudbees-core chart:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cosign verify --key https://cdn.cloudbees.com/keyring/cloudbees.pub helm.cloudbees.com/cloudbees-core:3.14250.0_ba76d23d3618
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>[{</span><span style=color:#e6db74>&#34;critical&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;identity&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;docker-reference&#34;</span>:<span style=color:#e6db74>&#34;helm-internal.artifacts.cloudbees.com/cloudbees-core&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;image&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;docker-manifest-digest&#34;</span>:<span style=color:#e6db74>&#34;sha256:b7aab6f5a3e87035eb5af8cfbe2280d4cd564d1f6c643d6f4007586348d4f435&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;cosign container image signature&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;optional&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;Bundle&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;SignedEntryTimestamp&#34;</span>:<span style=color:#e6db74>&#34;MEUCIFW76mN5GK6PfIMzbqtYKKecCNtxUIXsq2EwQJPPmJIoAiEAvRpja9pFs0hmwpeFlCeEt5BMvrtQIfSEMJ09j8w9Il8=&#34;</span>,<span style=color:#e6db74>&#34;Payload&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;body&#34;</span>:<span style=color:#e6db74>&#34;eyJhcGlWZXJzaW9uIjoiMC4wLjEiLCJraW5kIjoiaGFzaGVkcmVrb3JkIiwic3BlYyI6eyJkYXRhIjp7Imhhc2giOnsiYWxnb3JpdGhtIjoic2hhMjU2IiwidmFsdWUiOiJjNjI5YjVhZDAxNjQ4MWE4MDQzMWFhNzVjODFmMjk3OGJmZGM1YWQyMjQ2YTAwMmVhYzg1MWFkMGE3OWRmMDcyIn19LCJzaWduYXR1cmUiOnsiY29udGVudCI6Ik1FVUNJUUNmdEFuaFE1VUFRODdZNEtqOURVbHVjM05LcXR4RHJhM3pGYkxWbnROK2lRSWdiUlY5UloyZjNqeWcrYUNrZDNpRWZtT0lyUmtUdUNtMUhuMGNOOE5wd3Y4PSIsInB1YmxpY0tleSI6eyJjb250ZW50IjoiTFMwdExTMUNSVWRKVGlCUVZVSk1TVU1nUzBWWkxTMHRMUzBLVFVacmQwVjNXVWhMYjFwSmVtb3dRMEZSV1VsTGIxcEplbW93UkVGUlkwUlJaMEZGYVVsRU1UaE1OR2R1ZEhCbVJXUmFVekl3SzB0WVpUVTVOalZqYWdwSmVrRTFjalJZTWxST1VVcFFiVWx1VGpkbmJXTlJaMngxWWxKblprRXZkMDVNZEd4cEx6TjNVak5xWlhCbFNIVnNZak16VTJKWGIwNTNQVDBLTFMwdExTMUZUa1FnVUZWQ1RFbERJRXRGV1MwdExTMHRDZz09In19fX0=&#34;</span>,<span style=color:#e6db74>&#34;integratedTime&#34;</span>:1694639884,<span style=color:#e6db74>&#34;logIndex&#34;</span>:36228316,<span style=color:#e6db74>&#34;logID&#34;</span>:<span style=color:#e6db74>&#34;c0d23d6ad406973f9559f3ba2d1ca01f84147d8ffc5b8445c224f98b9591801d&#34;</span><span style=color:#f92672>}}}}]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Verification <span style=color:#66d9ef>for</span> helm.cloudbees.com/cloudbees-core:3.14250.0_ba76d23d3618 --
</span></span><span style=display:flex><span>The following checks were performed on each of these signatures:
</span></span><span style=display:flex><span>  - The cosign claims were validated
</span></span><span style=display:flex><span>  - Existence of the claims in the transparency log was verified offline
</span></span><span style=display:flex><span>  - The signatures were verified against the specified public key
</span></span></code></pre></div><blockquote><p>Note: replace <code>+</code> for <code>_</code> in the OCI Image Tag (OCI tags dont support the + that&rsquo;s typically used to denote build metadata of a version in semver).</p></blockquote><p>The <a href=https://docs.cloudbees.com/docs/cloudbees-ci/latest/cloud-secure-guide/helm-verification>Cloudbees Docs</a> explains it.</p><h3 id=42-verify-the-provenance-layer-in-oci-image>4.2. Verify The Provenance Layer In OCI Image</h3><p>If the chart use a provenance file, it can be built-in to the OCI Image as a Layer. For example the <a href="https://github.com/argoproj/argo-helm/pkgs/container/argo-helm%2Fargo-cd/129237573?tag=5.46.6">Image Manifest for ArgoCD</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm pull --verify oci://ghcr.io/argoproj/argo-helm/argo-cd --version 5.46.6
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Pulled: ghcr.io/argoproj/argo-helm/argo-cd:5.46.6
</span></span><span style=display:flex><span>Digest: sha256:28b4cb53a4f188501779808f4cc40d71b7a51f7bfa39b8ac3ca9f6b523c1c198
</span></span><span style=display:flex><span>Pulled: ghcr.io/argoproj/argo-helm/argo-cd:5.46.6
</span></span><span style=display:flex><span>Digest: sha256:28b4cb53a4f188501779808f4cc40d71b7a51f7bfa39b8ac3ca9f6b523c1c198
</span></span><span style=display:flex><span>Signed by: Argo Helm maintainers &lt;cncf-argo-security@lists.cncf.io&gt;
</span></span><span style=display:flex><span>Using Key With Fingerprint: 2B8F22F57260EFA67BE1C5824B11F800CD9D2252
</span></span><span style=display:flex><span>Chart Hash Verified: sha256:4422d42afae57c4b7a4d006e132068fd2cf6debf008e48132df1c9582e161fd2
</span></span></code></pre></div><p>If no provenance layer exists, we&rsquo;ll see &ldquo;Error: failed to fetch provenance&rdquo;:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm pull <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--verify <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>oci://chartproxy.container-registry.com/argoproj.github.io/argo-helm/argo-cd <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--version 5.46.6
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Pulled: chartproxy.container-registry.com/argoproj.github.io/argo-helm/argo-cd:5.46.6
</span></span><span style=display:flex><span>Digest: sha256:c34662902fcd868e184849fdfc6d1fbc42bee770029d6a69520eb0671d5f74f1
</span></span><span style=display:flex><span>Error: failed to fetch provenance <span style=color:#e6db74>&#34;oci://chartproxy.container-registry.com/argoproj.github.io/argo-helm/argo-cd:5.46.6.prov&#34;</span>
</span></span></code></pre></div><p>We can see this explicitly by pulling the <code>--prov</code> option:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm pull <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--prov <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>oci://chartproxy.container-registry.com/argoproj.github.io/argo-helm/argo-cd <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--version 5.46.6
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Pulled: chartproxy.container-registry.com/argoproj.github.io/argo-helm/argo-cd:5.46.6
</span></span><span style=display:flex><span>Digest: sha256:d0139e91f899dd9502923ce0714b1a2eff2a07909fdf84e77aa78d6e733cb146
</span></span><span style=display:flex><span>WARNING: Verification not found <span style=color:#66d9ef>for</span> oci://chartproxy.container-registry.com/argoproj.github.io/argo-helm/argo-cd: manifest does not contain a layer mediatype application/vnd.cncf.helm.chart.provenance.v1.prov
</span></span></code></pre></div><p>This time, Helm clarifies that the layer is missing: &ldquo;manifest does not contain a layer mediatype application/vnd.cncf.helm.chart.provenance.v1.prov&rdquo;</p><blockquote><h3 id=side-quest-query-public-chart-manifest>Side Quest: Query Public Chart Manifest</h3><p>You can query an OCI chart manifest from the public chart proxy like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl https://chartproxy.container-registry.com/v2/argoproj.github.io/argo-helm/argo-cd/manifests/5.46.6 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --silent <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --location <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  | jq
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;schemaVersion&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;mediaType&#34;</span>: <span style=color:#e6db74>&#34;application/vnd.oci.image.manifest.v1+json&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;config&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;mediaType&#34;</span>: <span style=color:#e6db74>&#34;application/vnd.cncf.helm.config.v1+json&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;digest&#34;</span>: <span style=color:#e6db74>&#34;sha256:44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;size&#34;</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;layers&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;mediaType&#34;</span>: <span style=color:#e6db74>&#34;application/vnd.cncf.helm.chart.content.v1.tar+gzip&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;digest&#34;</span>: <span style=color:#e6db74>&#34;sha256:4422d42afae57c4b7a4d006e132068fd2cf6debf008e48132df1c9582e161fd2&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;size&#34;</span>: <span style=color:#ae81ff>148855</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;annotations&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;org.opencontainers.image.title&#34;</span>: <span style=color:#e6db74>&#34;argo-cd-5.46.6.tgz&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;annotations&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;org.opencontainers.image.created&#34;</span>: <span style=color:#e6db74>&#34;2023-10-10T09:12:15Z&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></blockquote><p>One observation is the <a href=https://github.com/container-registry/helm-charts-oci-proxy>Helm Chart OCI Proxy</a> only provides the <code>tgz</code> layer. Config (the contents of <code>Chart.yaml</code>) and the provenance layer are not provided.</p><h3 id=43-verify-using-the-provenance-file-stored-in-classic-helm-repo-hack>4.3. Verify Using The Provenance File Stored In Classic Helm Repo (hack)</h3><h4 id=431-get-the-public-key>4.3.1 Get The Public Key</h4><p>Find the public key from artifacthub.io signed icon:</p><p><img src=./artifacthub-signed-icon.drawio.svg alt="Screenshot of artifacthub.io highlighting signed chart icon" title="Like Rocking Horse $hit: A Signed icon in colour!"></p><h4 id=432-convert-the-key-into-gnupg-format>4.3.2 Convert The Key Into GnuPG Format</h4><p>Download the key and convert it from OpenPGP ASCII Armor format into GPG binary format.</p><p>That&rsquo;s the format supported by helm. See Colin Wilson&rsquo;s <a href=https://colinwilson.uk/2022/02/07/verifying-signed-helm-charts/>Verifying Signed Helm Charts</a> for an explainer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl https://argoproj.github.io/argo-helm/pgp_keys.asc <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  | gpg --dearmor &gt; ~/.gnupg/pubring.gpg
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>1680</span>  <span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>1680</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>4253</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:--  <span style=color:#ae81ff>4242</span>
</span></span></code></pre></div><h4 id=433-download-the-provenance-file-separately>4.3.3 Download the Provenance File Separately</h4><p>Download the chart&rsquo;s provenance file separately from the HTTP repo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -LO https://github.com/argoproj/argo-helm/releases/download/argo-cd-5.46.6/argo-cd-5.46.6.tgz.prov
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:--     <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>1920</span>  <span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>1920</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>1782</span>      <span style=color:#ae81ff>0</span>  0:00:01  0:00:01 --:--:--     <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h4 id=434-verify-the-chart-package>4.3.4 Verify The Chart Package</h4><p>Finally, verify the packaged chart locally using the public key</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm verify argo-cd-5.46.6.tgz
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Signed by: Argo Helm maintainers &lt;cncf-argo-security@lists.cncf.io&gt;
</span></span><span style=display:flex><span>Using Key With Fingerprint: 2B8F22F57260EFA67BE1C5824B11F800CD9D2252
</span></span><span style=display:flex><span>Chart Hash Verified: sha256:4422d42afae57c4b7a4d006e132068fd2cf6debf008e48132df1c9582e161fd2
</span></span></code></pre></div><hr><h2 id=pull-a-public-chart-from-an-air-gapped-environment>Pull A Public Chart From An Air-Gapped Environment</h2><p>If you&rsquo;re in an air-gapped environment, you can put a private oci registry proxy in front of the public chart proxy.</p><p>That way, you can de-duplicate requests to the public chart proxy and cache charts logically closer to their point of use.</p><p>Here&rsquo;s a example using <a href=https://k3d.io/v5.6.0/usage/registries/#creating-a-registry-proxy-pull-through-registry>k3d</a> to prototype a pull-through registry.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>k3d registry create chartproxy-container-registry-com-mirror <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--image docker.io/library/registry:2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--port 0.0.0.0:5007 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--proxy-remote-url https://chartproxy.container-registry.com <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--volume /tmp/reg:/var/lib/registry <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--volume <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>/registry-config.yml:/etc/docker/registry/config.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--no-help
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>INFO<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> Creating node <span style=color:#e6db74>&#39;k3d-chartproxy-container-registry-com-mirror&#39;</span> 
</span></span><span style=display:flex><span>INFO<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> Successfully created registry <span style=color:#e6db74>&#39;k3d-chartproxy-container-registry-com-mirror&#39;</span> 
</span></span><span style=display:flex><span>INFO<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> Starting Node <span style=color:#e6db74>&#39;k3d-chartproxy-container-registry-com-mirror&#39;</span> 
</span></span><span style=display:flex><span>INFO<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> Successfully created registry <span style=color:#e6db74>&#39;k3d-chartproxy-container-registry-com-mirror&#39;</span>
</span></span></code></pre></div><h3 id=install-argocd-chart-using-air-gapped-chart-proxy>Install Argocd Chart Using Air-Gapped Chart Proxy</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create ns argo
</span></span><span style=display:flex><span>namespace/argo created
</span></span></code></pre></div><p>Then, from a push-based deployer machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm upgrade my-argo-cd <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>oci://localhost:5007/argoproj.github.io/argo-helm/argo-cd <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--namespace argo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--install <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--debug
</span></span></code></pre></div><hr><p>Thank you for reading this article right to the end.
If you enjoyed it and if you think others can benefit, please like and share!</p><p>If you&rsquo;d like to learn from a hands-on-keyboard tutorial for this chapter, let me know on <a href=https://www.linkedin.com/in/doughellinger/>LinkedIn</a>.</p><p>If you foresee a problem, have an alternative solution, I&rsquo;d appreciate your feedback. Again, reach me on <a href=https://www.linkedin.com/in/doughellinger/>LinkedIn</a>.</p><p>Special thank you to <a href=https://www.linkedin.com/in/danielepolencic/>Dan Polencic</a>. Appreciate the reviews and all your feedback!</p><p>Look out for the next Chapter on Exploring OCI Registries&mldr;</p></div><div class=after-post-tags><ul class=tags><li><a href=/tags/helm>helm</a></li><li><a href=/tags/chart>chart</a></li><li><a href=/tags/oci>oci</a></li><li><a href=/tags/proxy>proxy</a></li><li><a href=/tags/verify>verify</a></li><li><a href=/tags/kubernetes>kubernetes</a></li><li><a href=/tags/gpg>gpg</a></li><li><a href=/tags/sigstore>sigstore</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="d-block col-md-6 text-lg-right" href=https://www.douglashellinger.com/how-to/publish-markdown-document-to-medium/>How To Post To Medium Without The Tedium &#187;</a><div class=clearfix></div></div></div></div></div><div class=container><div id=comments class="row justify-content-center mb-5"><div class=col-md-8></div></div></div></div></div><div class="jumbotron fortags"><div class="d-md-flex h-100"><div class="col-md-4 transpdark align-self-center text-center h-100"><div class="d-md-flex align-items-center justify-content-center h-100"><h2 class="d-md-block d-none align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2></div></div><div class="col-md-8 p-5 align-self-center text-center"><a class="mt-1 mb-1" href=/tags/ai>ai</a>
<a class="mt-1 mb-1" href=/tags/build-pipeline>build-pipeline</a>
<a class="mt-1 mb-1" href=/tags/builder-image>builder-image</a>
<a class="mt-1 mb-1" href=/tags/chart>chart</a>
<a class="mt-1 mb-1" href=/tags/cloud>cloud</a>
<a class="mt-1 mb-1" href=/tags/container>container</a>
<a class="mt-1 mb-1" href=/tags/containers>containers</a>
<a class="mt-1 mb-1" href=/tags/copilot>copilot</a>
<a class="mt-1 mb-1" href=/tags/crd>crd</a>
<a class="mt-1 mb-1" href=/tags/cri>cri</a>
<a class="mt-1 mb-1" href=/tags/ctf>ctf</a>
<a class="mt-1 mb-1" href=/tags/cybersecurity>cybersecurity</a>
<a class="mt-1 mb-1" href=/tags/deployment>deployment</a>
<a class="mt-1 mb-1" href=/tags/distribution>distribution</a>
<a class="mt-1 mb-1" href=/tags/docs-as-code>docs-as-code</a>
<a class="mt-1 mb-1" href=/tags/driver>driver</a>
<a class="mt-1 mb-1" href=/tags/encryption>encryption</a>
<a class="mt-1 mb-1" href=/tags/food>food</a>
<a class="mt-1 mb-1" href=/tags/github>github</a>
<a class="mt-1 mb-1" href=/tags/gpg>gpg</a>
<a class="mt-1 mb-1" href=/tags/helm>helm</a>
<a class="mt-1 mb-1" href=/tags/kubernetes>kubernetes</a>
<a class="mt-1 mb-1" href=/tags/medium>medium</a>
<a class="mt-1 mb-1" href=/tags/oci>oci</a>
<a class="mt-1 mb-1" href=/tags/overthewire>overthewire</a>
<a class="mt-1 mb-1" href=/tags/pair-programming>pair-programming</a>
<a class="mt-1 mb-1" href=/tags/problem-solving>problem-solving</a>
<a class="mt-1 mb-1" href=/tags/programming>programming</a>
<a class="mt-1 mb-1" href=/tags/proxy>proxy</a>
<a class="mt-1 mb-1" href=/tags/registry>registry</a>
<a class="mt-1 mb-1" href=/tags/runtime>runtime</a>
<a class="mt-1 mb-1" href=/tags/security>security</a>
<a class="mt-1 mb-1" href=/tags/sigstore>sigstore</a>
<a class="mt-1 mb-1" href=/tags/stream-cipher>stream-cipher</a>
<a class="mt-1 mb-1" href=/tags/thinkpad>thinkpad</a>
<a class="mt-1 mb-1" href=/tags/troubleshooting>troubleshooting</a>
<a class="mt-1 mb-1" href=/tags/ubuntu>ubuntu</a>
<a class="mt-1 mb-1" href=/tags/verify>verify</a>
<a class="mt-1 mb-1" href=/tags/writing>writing</a></div></div></div><footer class=footer><div class=container><div class=row><div class="col-md-6 col-sm-6 text-center text-lg-left">&copy; Copyright Douglas Hellinger 2022 - Present</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target=_blank rel=noopener href=https://www.wowthemes.net>Mediumish Theme</a> by WowThemes.net</div></div></div></footer></div><script src=https://code.jquery.com/jquery-3.4.1.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js integrity=sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=https://www.douglashellinger.com/js/mediumish.84218587c174fd40bce82544b98851670f0b124a7324b349c54a4065e2b32ffc.js integrity="sha256-hCGFh8F0/UC86CVEuYhRZw8LEkpzJLNJxUpAZeKzL/w="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TEH3VGXMRY"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TEH3VGXMRY",{anonymize_ip:!1})}</script></body></html>